# 消防安全管理系统

## 项目简介

消防安全管理系统是一个专为消防安全管理设计的综合平台，用于管理微型消防站物资和消防器材。系统提供物资信息管理、有效期预警、数据分析和用户权限管理等功能，帮助机构有效管理消防安全资源，确保及时更换过期器材。

## 主要功能

- **物资管理**：管理微型消防站物资信息，包括添加、编辑、删除和查询
- **消防器材管理**：管理灭火器、呼吸器等消防器材信息
- **有效期预警**：自动监控物资和器材的有效期，提供即将到期和已过期物资列表
- **预警邮件**：自动向负责人发送有效期预警邮件
- **数据分析**：提供到期时间分析、负责人分析和区域分析等多维度数据分析功能
- **用户权限管理**：基于角色和区域的细粒度权限控制
- **责任人管理**：管理各区域的负责人信息
- **邮件日志**：记录系统发送的所有预警邮件

## 技术栈

- **后端**：Flask (Python)
- **前端**：Bootstrap 5, JavaScript, Chart.js
- **数据库**：SQLite (可扩展至其他关系型数据库)
- **认证**：Flask-Login
- **表单处理**：Flask-WTF
- **数据可视化**：Chart.js

## 安装步骤

1. 克隆代码仓库
   ```bash
   git clone https://github.com/smallfish618/safety.git
   cd safety
   ```

2. 创建并激活虚拟环境
   ```bash
   python -m venv venv
   
   # Windows
   venv\Scripts\activate
   
   # Linux/Mac
   source venv/bin/activate
   ```

3. 安装依赖
   ```bash
   pip install -r requirements.txt
   ```

4. 配置环境变量
   ```bash
   # 复制示例配置文件并按需修改
   cp config.example.py config.py
   
   # 编辑config.py，设置SECRET_KEY和邮件服务器配置
   ```

5. 初始化数据库
   ```bash
   # 确保data目录存在
   mkdir -p data
   
   # 创建数据库表
   flask db upgrade
   ```

6. 运行应用
   ```bash
   flask run
   ```

7. 访问应用
   ```
   http://127.0.0.1:5000
   ```

## 系统模块

### 物资管理模块

- 微型消防站物资管理
- 消防器材（灭火器、呼吸器）管理
- 根据区域、物品名称、负责人等条件筛选和搜索

### 有效期管理模块

- 设置不同物品类型的有效期规则
- 有效期预警（已过期、30天内、60天内、90天内）
- 预警邮件发送功能，支持自定义预警内容

### 分析模块

- **分析概览**：物资总量、区域分布、负责人分布等概览信息
- **到期时间分析**：物资到期时间分布，包括类别分析和趋势预测
- **负责人分析**：各负责人管理的物资数量、到期情况等
- **区域分析**：各区域物资分布、种类统计、到期状况等

### 用户权限管理

- 支持管理员和普通用户角色
- 基于区域和操作类型的细粒度权限控制
- 支持查看、添加、编辑、删除四种操作权限

## 最近更新

### 物品分析功能

现已添加完整的物品分析功能，包括：

- 分析概览：提供关键统计数据和分布图表
- 到期时间分析：详细显示不同时间段内到期物品的分布
- 负责人分析：展示各负责人的物资数量和到期状况
- 区域分析：分析各区域的物资分布和种类统计

### 邮件预警增强

- 支持按负责人筛选发送预警邮件
- 个性化邮件内容，每位负责人只收到自己负责区域的预警信息
- 添加邮件发送日志，记录所有预警邮件的发送状态

## 用户角色

1. **管理员**：拥有系统所有功能的完整访问权限
2. **普通用户**：根据分配的权限访问特定区域的物资信息

## 贡献指南

欢迎贡献代码或提出改进建议：

1. Fork项目仓库
2. 创建您的功能分支 (`git checkout -b feature/AmazingFeature`)
3. 提交您的更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 发起Pull Request

## 许可证

MIT License
